---
title: "Untitled"
output: html_document
date: "2022-11-28"
---
```{r}
library(tidyverse)
library(reshape2)
```

```{r}
Unc_Conts<-read_csv("Data_Cilantro_Outputs/Water_Testing_Analysis_R2.csv")
```

```{r}
Unc_Conts<-Unc_Conts %>% 
  select(-...1) %>% 
  mutate(N10Lsamples= as.factor(N10Lsamples)) %>% 
  group_by(N10Lsamples, Conts) %>% 
  summarise(median = median(PDetect), q05 = quantile(PDetect, 0.05), q95 = quantile(PDetect, 0.95)) 
```
Unc_Conts %>% 
  ggplot(aes(x = Conts, y = median, shape =N10Lsamples, linetype =N10Lsamples, color =N10Lsamples,ymin=q05, ymax=q95, fill = N10Lsamples))+
  geom_point(alpha = 0.5)+
  geom_line()+
  geom_ribbon(alpha= 0.3)+
  labs(x = "Contamination Levels Bulk Water: Oocyst/L", y = "Probability of Detection: 10L Sample(s)", fill = "No. 10L Samples", color= "No. 10L Samples", shape = "No. 10L Samples", linetype ="No. 10L Samples" )

ggsave("Contamination vs Method- R2.jpeg", width = 15, height = 10, units = "cm", dpi = 600)


```{r}
Unc_Conts %>% 
  filter(Conts <2) %>% 
  ggplot(aes(x = Conts, y = median, shape =N10Lsamples, linetype =N10Lsamples, color =N10Lsamples,ymin=q05, ymax=q95, fill = N10Lsamples))+
  geom_point(alpha = 0.5,size = 2.5)+
  geom_line()+
  geom_ribbon(alpha= 0.3)+
  labs(x = "Contamination Levels Bulk Water: Oocyst/L", y = "Probability of Detection: 10L Sample(s)", fill = "No. 10L Samples", color= "No. 10L Samples", shape = "No. 10L Samples", linetype ="No. 10L Samples" )+
  theme_bw()+
  theme(legend.position="top")


ggsave("Contamination vs Method-R2.jpeg", width = 15, height = 10, units = "cm", dpi = 600)
```

```{r}
Conts_WT = Unc_Conts[1:200,2]


WT_1<-Unc_Conts %>% 
  filter(N10Lsamples==1)

WT_2<-Unc_Conts %>% 
  filter(N10Lsamples==2)

WT_4<-Unc_Conts %>% 
  filter(N10Lsamples==4)

WT_8<-Unc_Conts %>% 
  filter(N10Lsamples==8)

WT_16<-Unc_Conts %>% 
  filter(N10Lsamples==16)

WT_32<-Unc_Conts %>% 
  filter(N10Lsamples==32)

Conts_WT$`1`<-WT_1$median-WT_1$median
Conts_WT$`2`<-WT_2$median-WT_1$median
Conts_WT$`4`<-WT_4$median-WT_1$median
Conts_WT$`8`<-WT_8$median-WT_1$median
Conts_WT$`16`<-WT_16$median-WT_1$median
Conts_WT$`32`<-WT_32$median-WT_1$median

Conts_WT %>% 
  melt(id = "Conts") %>% 
  filter(Conts<2) %>% 
  ggplot(aes(x = Conts, y = value, color = variable,shape =variable, fill = variable))+
  geom_point(size= 2.5)+
  geom_line()+
  theme_bw()+
  labs(x = "Contamination Levels Bulk Water: Oocyst/L", y = "Difference in median probability of detection\n n number of samples vs. 1 10L Sample", color = "No. 10L Samples", shape = "No. 10L Samples", fill = "No. 10L Samples")+
  theme(legend.position="top")

ggsave("Contamination vs Method Differences Water-R2.jpeg", width = 15, height = 10, units = "cm", dpi = 600)


```


```{r}
log10(10000000/(20000*454))
```


```{r}
Unc_Conts<-read_csv("Data_Cilantro_Outputs/Product_Testing_Analysis_R2.csv")
Unc_Conts$Conts<- log10(Unc_Conts$Conts)
```

```{r}
Unc_Conts<-Unc_Conts %>%
  mutate(log_CFU_g_conts = log10(10^Conts/(454*22000))) %>% 
  select(-...1) %>% 
  mutate(N25gsamples= as.factor(N25gsamples)) %>% 
  group_by(N25gsamples, log_CFU_g_conts) %>% 
  summarise(median = median(PDetect), q05 = quantile(PDetect, 0.05), q95 = quantile(PDetect, 0.95)) 



Unc_Conts %>% 
  ggplot(aes(x = log_CFU_g_conts, y = median, color =N25gsamples, shape =N25gsamples, linetype =N25gsamples, ymin=q05, ymax=q95, fill = N25gsamples))+
  geom_point(alpha = 0.5, size = 2.5)+
  geom_line()+
  geom_ribbon(alpha= 0.3)+
  theme_bw()+
  theme(legend.position="top")+
  labs(x = "Contamination Levels in Field: log (Oocysts/g) ", y = "Probability of Detection: 25g sample(s)", fill = "No. 25 g Samples", color= "No. 25 g Samples", linetype = "No. 25 g Samples", shape = "No. 25 g Samples")


ggsave("Contamination vs Field Contam-R2.jpeg", width = 15, height = 10, units = "cm", dpi = 600)

```

```{r}
Conts_PD = Unc_Conts[1:45,2]
as.data.frame(Conts_PD)

PD_1<-Unc_Conts %>% 
  filter(N25gsamples==1)

PD_2<-Unc_Conts %>% 
  filter(N25gsamples==2)

PD_4<-Unc_Conts %>% 
  filter(N25gsamples==4)

PD_8<-Unc_Conts %>% 
  filter(N25gsamples==8)

PD_16<-Unc_Conts %>% 
  filter(N25gsamples==16)

PD_32<-Unc_Conts %>% 
  filter(N25gsamples==32)

Conts_PD$`1`<-PD_1$median-PD_1$median
Conts_PD$`2`<-PD_2$median-PD_1$median
Conts_PD$`4`<-PD_4$median-PD_1$median
Conts_PD$`8`<-PD_8$median-PD_1$median
Conts_PD$`16`<-PD_16$median-PD_1$median
Conts_PD$`32`<-PD_32$median-PD_1$median

Conts_PD %>% 
  melt(id = "log_CFU_g_conts") %>% 
  #filter(log_CFU_g_conts<2) %>% 
  ggplot(aes(x = log_CFU_g_conts, y = value, color = variable,shape =variable, fill = variable))+
  geom_point(size= 2.5)+
  geom_line()+
  theme_bw()+
  theme(legend.position="top")+
  labs(x = "Contamination Levels in Field: log (Oocysts/g)", y = "Difference in median probability of detection\n n number of samples vs. 1 25g Sample", color = "No. 25g Samples", shape = "No. 25g Samples", fill = "No. 25g Samples")

ggsave("Contamination vs Method Differences Contam-R2.jpeg", width = 15, height = 10, units = "cm", dpi = 600)

```


```{r}
Unc_Conts %>% 
  filter(Conts<5.0e+06) %>% 
  ggplot(aes(x = Conts, y = median, color =N25gsamples,ymin=q05, ymax=q95, fill = N25gsamples))+
  geom_point(alpha = 0.5)+
  geom_line()+
  geom_ribbon(alpha= 0.3)+
  labs(x = "Contamiantion levels total Oocysts in Field", y = "Probability of Detection", fill = "No. 25g Samples", color= "No. 25g Samples")
```



### Logistic Fits

```{r}
#product Testing
PT_Qpcr_Results<-read_csv("Data_Cilantro_Outputs/qPCR_Fit_Product_Testing.csv")
PT_Qpcr_Probs<-read_csv("Data_Cilantro_Outputs/qPCR_Fit_Product_Testing_Probs.csv")

ggplot()+
  geom_hline(aes(yintercept = .29),color = "orange")+
  geom_hline(aes(yintercept = .82),color = "red")+  
  geom_vline(aes(xintercept = 5),color = "orange")+
  geom_vline(aes(xintercept = 10),color = "red")+
  geom_line(aes(x = Cont, y = `Prob Detect`), data = PT_Qpcr_Probs)+
  geom_point(aes(x = Cont, y = Results), data = PT_Qpcr_Results,position = position_jitter(height = 0.01, width = 1),shape= 21, fill = "skyblue")+
  labs(x= "Oocyst/ 25 g Sample", y = "Predicted Probability of Detection", title = "Logistic Fit: Product Testing")+
  theme_bw()

  ggsave(filename="Product Testing Fit.png",width = 15, height = 10, units = "cm", dpi = 600)
  
  
#Water Testing
PT_Qpcr_Results<-read_csv("Data_Cilantro_Outputs/qPCR_Fit_Water_Testing.csv")
PT_Qpcr_Probs<-read_csv("Data_Cilantro_Outputs/qPCR_Fit_Water_Testing_Probs.csv")

ggplot()+
  #geom_hline(aes(yintercept = .29),color = "orange")+
  geom_hline(aes(yintercept = .66),color = "red")+  
  #geom_vline(aes(xintercept = 5),color = "orange")+
  geom_vline(aes(xintercept = 6),color = "red")+
  geom_line(aes(x = Cont, y = `Prob Detect`), data = PT_Qpcr_Probs)+
  geom_point(aes(x = Cont, y = Results), data = PT_Qpcr_Results,position = position_jitter(height = 0.01, width = 1),shape= 21, fill = "skyblue")+
  labs(x= "Oocyst/ 10L Sample", y = "Predicted Probability of Detection", title = "Logistic Fit: Agricultural Water Testing")+
  theme_bw()

  ggsave(filename="Water Testing Fit.png",width = 15, height = 10, units = "cm", dpi = 600)
  

```

